@inherits BladixComponentBase
@implements IDisposable

@if (Item?.IsOpen == true || ForceMount)
{
    @if (AsChild)
    {
        @ChildContent
    }
    else
    {
        <div @attributes="AdditionalAttributes"
             id="@Item?.ContentId"
             role="region"
             aria-labelledby="@(Item?.HasTrigger == true ? Item?.TriggerId : Item?.HeaderId)"
             aria-hidden="@(Item?.IsOpen != true ? "true" : null)"
             data-state="@(Item?.IsOpen == true ? "open" : "closed")"
             data-disabled="@((Item?.Disabled == true || Root?.Disabled == true) ? "true" : null)"
             data-orientation="@Root?.Orientation.ToString().ToLowerInvariant()"
             hidden="@(Item?.IsOpen != true ? true : (bool?)null)"
             class="@Class" 
             style="@Style"
             @ref="ElementRef">
            @ChildContent
        </div>
    }
}

@code {
    /// <summary>
    /// Gets the parent AccordionRoot component cascaded from the component tree.
    /// </summary>
    [CascadingParameter] 
    public AccordionRoot? Root { get; set; }

    /// <summary>
    /// Gets the parent AccordionItem component cascaded from the component tree.
    /// </summary>
    [CascadingParameter] 
    public AccordionItem? Item { get; set; }

    /// <summary>
    /// Gets or sets a value indicating whether to force-mount the content in the DOM.
    /// When true, the content is always present in DOM even when closed.
    /// Useful for controlling animations with CSS.
    /// </summary>
    [Parameter] 
    public bool ForceMount { get; set; }

    /// <summary>
    /// Registers this content with the parent item on initialization.
    /// </summary>
    protected override void OnInitialized()
    {
        Item?.RegisterContent(this);
    }

    /// <summary>
    /// Unregisters this content from the parent item when disposed.
    /// Implements IDisposable pattern for cleanup.
    /// </summary>
    public void Dispose()
    {
        Item?.UnregisterContent(this);
    }
}
